<!--The HTML code is property to Mr. You (Kristiyan Valchev) and can only be viewed-->
<!--If you want to use part of the code, please first contact me: mr.youdevelopment@gmail.com-->

<html id = "html">
    <head>
        <link href = "https://fonts.googleapis.com/css2?family=Nunito:wght@200;300;400;600;700;800;900&display=swap" rel = "stylesheet">
        <link type = "text/css" rel = "stylesheet" href = "Files/Style.css">
        <link rel = "icon" href = "Images/Logo.png" type = "image" sizes = "16x16">

        <meta charset = "utf-8">
        <meta name = "description" content = "Образователна платформа за упражнение и обучение по български език и литература. А кой е Онан? Ела да разбереш.">
        <meta name = "keywords" content = "Български, Език, Литература, Упражнения, Уптажнение, Тест, Тестове, Изпит, Изпитване, Онан, Учи, Учене, Образование, Купи, Продай, Стари, Учебници, Стар, Учебник, Магазин, Учебна, Ученик, Акаунт">
        <meta name = "author" content = "Kristiyan Valchev">
        <meta name = "viewport" content = "width = device-width, initial-scale = 1">
        
        <script type = "text/javascript" src = "Files/Functions.js"></script>
        <script type = "text/javascript" src = "https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script type = "text/javascript" src = "https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
        <script src = "https://kit.fontawesome.com/190623e0b3.js" crossorigin = "anonymous"></script>

        <title id = "Title">Онан - Акаунт</title>
    </head>

    <body id = "body" onload = "loadUserData()">
        <!-- #region Default -->
        <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-app.js"></script>
        <script src = "https://www.gstatic.com/firebasejs/7.24.0/firebase-auth.js"></script>
        <script src = "https://www.gstatic.com/firebasejs/7.24.0/firebase-firestore.js"></script>
        <script type = "text/javascript" src = "Files/logInForm.js"></script>

        <img src = "Images/Thumbnails/Main.png" alt = "Link image" style = "display: none;">

        <script>
            window.scroll(
            {
                top: 0,
                left: 0,
                behavior: 'smooth'
            });

            if (document.addEventListener)
            {
                document.addEventListener('contextmenu', function(e)
                {
                    document.getElementById("rightClickMenu").style.display = "block";
                    document.getElementById("rightClickMenuBox").style.top = e.clientY;
                    document.getElementById("rightClickMenuBox").style.left = e.clientX;
                    checkIfSelectedText();
                    e.preventDefault();
                }, false);
            }
            else
            {
                document.attachEvent('oncontextmenu', function()
                {
                    document.getElementById("rightClickMenu").style.display = "block";
                    document.getElementById("rightClickMenuBox").style.top = event.clientY;
                    document.getElementById("rightClickMenuBox").style.left = event.clientX;
                    checkIfSelectedText();
                    window.event.returnValue = false;
                });
            }
		</script>
        <!-- #endregion Default -->

        <div onclick = "closeRightClickMenu()" class = "rightClickMenu" id = "rightClickMenu">
            <div class = "rightClickMenuBox" id = "rightClickMenuBox">
                <a href = "javascript:history.go(-1)">Back</a>
                <a href = "javascript:history.go(+1)">Forword</a>
                <a href = "javascript:history.go(0)">Reload</a>
                <div class = "lineDevider"></div>
                <a onclick = "copySelectedText()" class = "Unactive" id = "rightClickMenuCopyTextButton">Copy text</a>
            </div>
        </div>

        <div class = "bigSideBoxHolder" id = "bigSideBoxHolder"><div id = "bigSideBox"></div></div>

        <a href = "indexAccount.html" class = "topBarName" id = "topBarName"><i class = "fas fa-graduation-cap"></i> Онан</a>
        <a onclick = "openCloseSideMenu()" class = "threeLineButton" id = "sideMenuButton"><div id = "firstLine"></div><div id = "secondLine"></div></a>

        <div class = "sideMenu" id = "sideMenu">
            <div class = "optionsList">
                <a href = "indexAccount.html" class = "sideMenuOption Active">Начало</a>
                <a onclick = "openCloseSideMenuDropdown('урочноСъдържаниеList')" class = "sideMenuOption">Урочно съдържание</a>
                <div class = "sideMenuDropdown" id = "урочноСъдържаниеList">
                    <a href = "schoolProgram/Class5.html" class = "sideMenuDropdownOption">5-ти клас</a>
                    <a href = "schoolProgram/Class6.html" class = "sideMenuDropdownOption">6-ти клас</a>
                    <a href = "schoolProgram/Class7.html" class = "sideMenuDropdownOption">7-ми клас</a>
                    <a href = "schoolProgram/Class8.html" class = "sideMenuDropdownOption">8-ми клас</a>
                    <a href = "schoolProgram/Class9.html" class = "sideMenuDropdownOption">9-ти клас</a>
                    <a href = "schoolProgram/Class10.html" class = "sideMenuDropdownOption">10-ти клас</a>
                    <a href = "schoolProgram/Class11.html" class = "sideMenuDropdownOption">11-ти клас</a>
                    <a href = "schoolProgram/Class12.html" class = "sideMenuDropdownOption">12-ти клас</a>
                </div>
                <a href = "#" class = "sideMenuOption">Научи нещо ново</a>
                <a onclick = "openCloseSideMenuDropdown('изпитванеList')" class = "sideMenuOption">Изпитване</a>
                <div class = "sideMenuDropdown" id = "изпитванеList">
                    <a href = "Task/bulgarianLanguage.html" class = "sideMenuDropdownOption">Български език</a>
                    <a href = "Task/Literature.html" class = "sideMenuDropdownOption">Литература</a>
                    <a href = "Task/commonTest.html" class = "sideMenuDropdownOption">Общо</a>
                </div>
                <a href = "#" class = "sideMenuOption">Купи & продай</a>
                <a href = "whyOnan.html" class = "sideMenuOption">Защо Онан?</a>
                <a href = "Contacts.html" class = "sideMenuOption">Контакти</a>
            </div>
        </div>

        <div class = "mainTextsHolder">
            <h1 class = "mainTitle">Акаунта на <br><name id = "mainTitleUserName">...</name></h1>
            <p class = "mainText">
                Това си ти. Може да видиш успеваемостта си и да се похвалиш
                на останалите, дори да не си с висок резултат
            </p>
            <a onclick = "signOut()" class = "mainButtin">Sign out</a>
        </div>

        <img src = "Images/socialUser.svg" alt = "Boy, looking at a screen" class = "mainImage">

        <div class = "messageHolder">
            <!-- Correctnesses -->
            <div class = "correctnessHolder" id = "correctness userSighedUp">
                <p>Successfully Signed Up!</p>
            </div>
            <div class = "correctnessHolder" id = "correctness userSighedIn">
                <p>Successfully Signed In!</p>
            </div>
            <div class = "correctnessHolder" id = "correctness userSighedOut">
                <p>User Signed Out.</p>
            </div>
            <div class = "correctnessHolder" id = "correctness userDataSaved">
                <p>Information saved Successfully!</p>
            </div>

            <!-- Errors -->
            <div class = "errorHolder" id = "Error invalidEmail">
                <p>The email is invalid.</p>
            </div>
            <div class = "errorHolder" id = "Error existingEmail">
                <p>This email user is already existing.</p>
            </div>
            <div class = "errorHolder" id = "Error invalidPassword">
                <p>The password is invalid. It should be 6 characters long of higher.</p>
            </div>
            <div class = "errorHolder" id = "Error invalidFN">
                <p>The First Name is invalid.</p>
            </div>
            <div class = "errorHolder" id = "Error wrongPassword">
                <p>The password is wrong.</p>
            </div>
            <div class = "errorHolder" id = "Error nonExistingUser">
                <p>There is no user found.</p>
            </div>
            <div class = "errorHolder" id = "Error toManyRequests">
                <p>Access to this account has been temporarily disabled. Try again in 30 seconds.</p>
            </div>
            <div class = "errorHolder" id = "Error FNEmailFieladEmpty">
                <p>You cannot leave First Name and/or Email fields empty. Also, First and Last names cannot exceed 15 characters.</p>
            </div>
        </div>

        <div class = "pageContent">
            <div class = "pageContentSection">
                <h1 class = "pageContentSectionTitle">Статистика</h1>
                <div class = "chart" id = "rightWrongAnswersChart">
                    <p class = "chartTitle">Успеваемост</p>
                </div>
            </div>

            <div class = "pageContentSection withButtonEnd">
                <h1 class = "pageContentSectionTitle">Информация</h1>

                <div class = "inputField">
                    <input type = "text" placeholder = "First Name" class = "inputFieldText" id = "informationFNInputFieldText">
                    <label for = "name" class = "inputFieldLabel" id = "informationFNInputFieldLabel">First Name</label>
                </div>
                <div class = "inputField">
                    <input type = "text" placeholder = "Last Name" class = "inputFieldText" id = "informationLNInputFieldText">
                    <label for = "name" class = "inputFieldLabel" id = "informationLNInputFieldLabel">Last Name</label>
                </div>
                <div class = "inputField">
                    <input type = "number" placeholder = "number" class = "inputFieldText" id = "informationGradeInputFieldText" min = "5" max = "12">
                    <label for = "name" class = "inputFieldLabel" id = "informationGradeInputFieldLabel">Grade</label>
                </div>
                <div class = "inputField">
                    <input type = "email" placeholder = "email" class = "inputFieldText" id = "informationEmailInputFieldText" disabled>
                    <label for = "name" class = "inputFieldLabel" id = "informationEmailInputFieldLabel">Email</label>
                </div>

                <a onclick = "saveChangedUserData()" class = "pageContentSectionButton">Запази</a>
            </div>
            
            <div class = "bottomBar">
                <div class = "directionButton N"><a href = "indexAccount.html">Начало</a></div>
                <div class = "directionButton Z"><a href = "#">Защо Онан?</a></div>
                <div class = "directionButton M"><a href = "#">Контакти</a></div>
    
                <p class = "Credits">
                    <powerd>Site powered by <company>Mr. You Development</company>.</powerd>
                    <managed> Managed by <my>Kristiyan Valchecv</my></managed>
                </p>
            </div>
        </div>

        <script>
            var rightAnswers, wrongAnswers;
            var rightAnswersP, wrongAnswersP;

            firebase.auth().onAuthStateChanged(function(user)
            {
                if (user)
                {
                    cloudData.doc("users/" + user.uid).get().then(function(doc)
                    {
                        if (doc && doc.exists)
                        {
                            const userData = doc.data();
                            rightAnswers = userData.rightAnswers;
                            wrongAnswers = userData.wrongAnswers;
                        }
                    }).catch(function(error)
                    {
                        console.log("Got an Error: " +  error);
                    })
                }
            });

            rightAnswersP = (rightAnswers * 100) / (rightAnswers + wrongAnswers);
            wrongAnswersP = (wrongAnswers * 100) / (rightAnswers + wrongAnswers);
            
            var rightWrongAnswersChartData =
            [
                {
                    title: "Правилно",
                    value: parseInt(rightAnswersP),
                    color: "#604589"
                },
                {
                    title: "Грешно",
                    value: parseInt(wrongAnswersP),
                    color: "#fb601e"
                }
            ]
            
            $(function()
            {
                $("#rightWrongAnswersChart").drawDoughnutChart(rightWrongAnswersChartData);
            });

            //#region Chart System

            ;(function($, undefined)
            {
                $.fn.drawDoughnutChart = function(data, options)
                {
                    var $this = this,
                    W = $this.width(),
                    H = $this.height(),
                    centerX = W/2,
                    centerY = H/2,
                    cos = Math.cos,
                    sin = Math.sin,
                    PI = Math.PI,
                    settings = $.extend(
                    {
                        segmentShowStroke : true,
                        segmentStrokeColor : "transparent",
                        segmentStrokeWidth : 1,
                        baseColor: "#11111120",
                        baseOffset: 4,
                        edgeOffset : 10,//offset from edge of $this -- 50 --
                        percentageInnerCutout : 75,
                        animation : true,
                        animationSteps : 90,
                        animationEasing : "easeInOutExpo",
                        animateRotate : true,
                        tipOffsetX: -8,
                        tipOffsetY: -45,
                        tipClass: "doughnutTip",
                        summaryClass: "doughnutSummary",
                        summaryTitle: "Общо",
                        summaryTitleClass: "doughnutSummaryTitle",
                        summaryNumberClass: "doughnutSummaryNumber",
                        beforeDraw: function() {  },
                        afterDrawed : function() {  },
                        onPathEnter : function(e,data) {  },
                        onPathLeave : function(e,data) {  }
                    }, options), animationOptions =
                    {
                        linear : function (t)
                        {
                            return t;
                        },
                        easeInOutExpo: function (t)
                        {
                            var v = t<.5 ? 8*t*t*t*t : 1-8*(--t)*t*t*t;
                            return (v>1) ? 1 : v;
                        }
                    }, requestAnimFrame = function()
                    {
                        return window.requestAnimationFrame ||
                        window.webkitRequestAnimationFrame ||
                        window.mozRequestAnimationFrame ||
                        window.oRequestAnimationFrame ||
                        window.msRequestAnimationFrame ||
                        function(callback)
                        {
                            window.setTimeout(callback, 1000 / 60);
                        };
                    }();

                    settings.beforeDraw.call($this);

                    var $svg = $('<svg width="' + W + '" height="' + H + '" viewBox="0 0 ' + W + ' ' + H + '" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"></svg>').appendTo($this),
                        $paths = [],
                        easingFunction = animationOptions[settings.animationEasing],
                        doughnutRadius = Min([H / 2,W / 2]) - settings.edgeOffset,
                        cutoutRadius = doughnutRadius * (settings.percentageInnerCutout / 100),
                        segmentTotal = 0;

                    //Draw base doughnut
                    var baseDoughnutRadius = doughnutRadius + settings.baseOffset,
                        baseCutoutRadius = cutoutRadius - settings.baseOffset;
                    $(document.createElementNS('http://www.w3.org/2000/svg', 'path')).attr(
                    {
                        "d": getHollowCirclePath(baseDoughnutRadius, baseCutoutRadius),
                        "fill": settings.baseColor
                    }).appendTo($svg);

                    //Set up pie segments wrapper
                    var $pathGroup = $(document.createElementNS('http://www.w3.org/2000/svg', 'g'));
                    $pathGroup.attr({opacity: 0}).appendTo($svg);

                    //Set up tooltip
                    var $tip = $('<div class="' + settings.tipClass + '" />').appendTo('body').hide(),
                        tipW = $tip.width(),
                        tipH = $tip.height();

                    //Set up center text area
                    var summarySize = (cutoutRadius - (doughnutRadius - cutoutRadius)) * 2,
                        $summary = $('<div class="' + settings.summaryClass + '" />').appendTo($this).css(
                        { 
                            width: summarySize + "px",
                            height: summarySize + "px",
                            "margin-left": -(summarySize / 2) + "px",
                            "margin-top": -(summarySize / 2) + "px"
                        });

                    var $summaryTitle = $('<p class="' + settings.summaryTitleClass + '">' + settings.summaryTitle + '</p>').appendTo($summary);
                    var $summaryNumber = $('<p class="' + settings.summaryNumberClass + '"></p>').appendTo($summary).css({opacity: 0});

                    for (var i = 0, len = data.length; i < len; i++)
                    {
                        segmentTotal += data[i].value;
                        $paths[i] = $(document.createElementNS('http://www.w3.org/2000/svg', 'path')).attr(
                        {
                            "stroke-width": settings.segmentStrokeWidth,
                            "stroke": settings.segmentStrokeColor,
                            "fill": data[i].color,
                            "data-order": i
                        }).appendTo($pathGroup).on("mouseenter", pathMouseEnter).on("mouseleave", pathMouseLeave).on("mousemove", pathMouseMove);
                    }

                    //Animation start
                    animationLoop(drawPieSegments);

                    //Functions
                    function getHollowCirclePath(doughnutRadius, cutoutRadius)
                    {
                        //Calculate values for the path.
                        //We needn't calculate startRadius, segmentAngle and endRadius, because base doughnut doesn't animate.
                        var startRadius = -1.570,// -Math.PI/2
                            segmentAngle = 6.2831,// 1 * ((99.9999/100) * (PI*2)),
                            endRadius = 4.7131,// startRadius + segmentAngle
                            startX = centerX + cos(startRadius) * doughnutRadius,
                            startY = centerY + sin(startRadius) * doughnutRadius,
                            endX2 = centerX + cos(startRadius) * cutoutRadius,
                            endY2 = centerY + sin(startRadius) * cutoutRadius,
                            endX = centerX + cos(endRadius) * doughnutRadius,
                            endY = centerY + sin(endRadius) * doughnutRadius,
                            startX2 = centerX + cos(endRadius) * cutoutRadius,
                            startY2 = centerY + sin(endRadius) * cutoutRadius;
                        var cmd =
                        [
                            'M', startX, startY,
                            'A', doughnutRadius, doughnutRadius, 0, 1, 1, endX, endY,//Draw outer circle
                            'Z',//Close path
                            'M', startX2, startY2,//Move pointer
                            'A', cutoutRadius, cutoutRadius, 0, 1, 0, endX2, endY2,//Draw inner circle
                            'Z'
                        ];

                        cmd = cmd.join(' ');
                        return cmd;
                    };

                    function pathMouseEnter(e)
                    {
                        var order = $(this).data().order;
                        $tip.text(data[order].title + ": " + data[order].value.toFixed(1) + "%").fadeIn(200);
                        settings.onPathEnter.apply($(this),[e,data]);
                    }

                    function pathMouseLeave(e)
                    {
                        $tip.hide();
                        settings.onPathLeave.apply($(this),[e,data]);
                    }

                    function pathMouseMove(e)
                    {
                        $tip.css(
                        {
                            top: e.pageY + settings.tipOffsetY,
                            left: e.pageX - $tip.width() / 2 + settings.tipOffsetX
                        });
                    }

                    function drawPieSegments(animationDecimal)
                    {
                        var startRadius = -PI / 2,//-90 degree
                            rotateAnimation = 1;
                        if (settings.animation && settings.animateRotate) rotateAnimation = animationDecimal;//count up between0~1

                        drawDoughnutText(animationDecimal, segmentTotal);

                        $pathGroup.attr("opacity", animationDecimal);

                        //If data have only one value, we draw hollow circle(#1).
                        if (data.length === 1 && (4.7122 < (rotateAnimation * ((data[0].value / segmentTotal) * (PI * 2)) + startRadius)))
                        {
                            $paths[0].attr("d", getHollowCirclePath(doughnutRadius, cutoutRadius));
                            return;
                        }

                        for (var i = 0, len = data.length; i < len; i++)
                        {
                            var segmentAngle = rotateAnimation * ((data[i].value / segmentTotal) * (PI * 2)),
                                endRadius = startRadius + segmentAngle,
                                largeArc = ((endRadius - startRadius) % (PI * 2)) > PI ? 1 : 0,
                                startX = centerX + cos(startRadius) * doughnutRadius,
                                startY = centerY + sin(startRadius) * doughnutRadius,
                                endX2 = centerX + cos(startRadius) * cutoutRadius,
                                endY2 = centerY + sin(startRadius) * cutoutRadius,
                                endX = centerX + cos(endRadius) * doughnutRadius,
                                endY = centerY + sin(endRadius) * doughnutRadius,
                                startX2 = centerX + cos(endRadius) * cutoutRadius,
                                startY2 = centerY + sin(endRadius) * cutoutRadius;
                            var cmd =
                            [
                                'M', startX, startY,//Move pointer
                                'A', doughnutRadius, doughnutRadius, 0, largeArc, 1, endX, endY,//Draw outer arc path
                                'L', startX2, startY2,//Draw line path(this line connects outer and innner arc paths)
                                'A', cutoutRadius, cutoutRadius, 0, largeArc, 0, endX2, endY2,//Draw inner arc path
                                'Z'//Cloth path
                            ];

                            $paths[i].attr("d", cmd.join(' '));
                            startRadius += segmentAngle;
                        }
                    }

                    function drawDoughnutText(animationDecimal, segmentTotal)
                    {
                        // Total number text aplyment
                        $summaryNumber.css({opacity: animationDecimal}).text((segmentTotal * animationDecimal).toFixed());
                    }

                    function animateFrame(cnt, drawData)
                    {
                        var easeAdjustedAnimationPercent =(settings.animation)? CapValue(easingFunction(cnt), null, 0) : 1;
                        drawData(easeAdjustedAnimationPercent);
                    }

                    function animationLoop(drawData)
                    {
                        var animFrameAmount = (settings.animation)? 1 / CapValue(settings.animationSteps, Number.MAX_VALUE, 1) : 1,
                            cnt =(settings.animation)? 0 : 1;
                        requestAnimFrame(function()
                        {
                            cnt += animFrameAmount;
                            animateFrame(cnt, drawData);
                            if (cnt <= 1)
                            {
                                requestAnimFrame(arguments.callee);
                            }
                            else
                            {
                                settings.afterDrawed.call($this);
                            }
                        });
                    }

                    function Max(arr)
                    {
                        return Math.max.apply(null, arr);
                    }

                    function Min(arr)
                    {
                        return Math.min.apply(null, arr);
                    }

                    function isNumber(n)
                    {
                        return !isNaN(parseFloat(n)) && isFinite(n);
                    }

                    function CapValue(valueToCap, maxValue, minValue)
                    {
                        if (isNumber(maxValue) && valueToCap > maxValue) return maxValue;
                        if (isNumber(minValue) && valueToCap < minValue) return minValue;
                        return valueToCap;
                    }

                    return $this;
                };
            })(jQuery);

            //#endregion
        </script>
    </body>
</html>